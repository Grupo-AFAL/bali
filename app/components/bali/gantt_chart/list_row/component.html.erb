<%= tag.div **options do %>
  <div class="gantt-chart-row-contents">
    <%= render Bali::Icon::Component.new('handle', class: 'handle') if !readonly %>
    <%= render Bali::Icon::Component.new('chevron-down', class: 'chevron-down', data: { action: 'click->gantt-foldable-item#toggle' }) if task.children.any? %>

    <%= render Bali::Tooltip::Component.new(class: class_names(children: task.children.any?)) do |tip| %>
      <% tip.trigger do %>
        <% if task.href %>
          <%= tag.a task.name,
                    href: task.href,
                    class: 'task-name',
                    **link_task_name_options %>
        <% else %>
          <%= tag.div task.name,
                      class: 'task-name',
                      **task.list_task_name_options %>
        <% end %>
      <% end %>

      <%= tag.p task.name %>
    <% end %>

    <% if task.actions_enabled? %>
      <%= render Bali::HoverCard::Component.new(
                 open_on_click: true,
                 placement: 'bottom',
                 content_padding: false,
                 **task.hover_card_options
      ) do |c| %>
        <% c.trigger(class: 'is-flex') do %>
          <%= render Bali::Icon::Component.new('more', class: 'gantt-chart-task-dropdown') %>
        <% end %>

        <% if task.info_action? %>
          <%= render Bali::Link::Component.new(
                    name: t('.open_details'),
                    icon_name: 'info-circle',
                    class: 'is-flex dropdown-item',
                    **task.info_action_options) %>
        <% end %>

        <% if task.complete_action? && !task.complete? %>
          <%= render Bali::Link::Component.new(
                    name: t('.complete_task'),
                    icon_name: 'checklist',
                    class: 'is-flex dropdown-item',
                    **task.complete_action_options) %>
        <% end %>

        <% if task.indent_action? && !task.first? %>
          <%= render Bali::Link::Component.new(
                    name: t('.indent_task'),
                    icon_name: 'indent',
                    class: 'is-flex dropdown-item',
                    **task.indent_action_options) %>
        <% end %>

        <% if task.outdent_action? && task.child? %>
          <%= render Bali::Link::Component.new(
                    name: t('.outdent_task'),
                    icon_name: 'outdent',
                    class: 'is-flex dropdown-item',
                    **task.outdent_action_options) %>
        <% end %>

        <% if task.delete_action? %>
          <div class="dropdown-divider"></div>
          <%= render Bali::Link::Component.new(
                    name: t('.delete_task'),
                    icon_name: 'trash',
                    class: 'is-flex dropdown-item has-text-danger',
                    **task.delete_action_options) %>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <% if task.children.any? %>
    <div class="gantt-chart-list-children"
        data-controller="sortable-list"
        data-sortable-list-group-name-value="gantt-list"
        data-sortable-list-handle-value=".handle"
        data-sortable-list-list-id-value="<%= task.id %>"
        data-sortable-list-pull-value="false"
        data-sortable-list-disabled-value="<%= readonly %>"
        data-sortable-list-animation-value="50"
        data-sortable-list-resource-name-value="<%= resource_name %>"
    >
      <% task.children.each do |child_task| %>
        <%= render Bali::GanttChart::ListRow::Component.new(
                   task: child_task,
                   readonly: readonly,
                   resource_name: resource_name,
                   list_param_name: list_param_name) %>
      <% end %>
    </div>
  <% end %>
<% end %>
